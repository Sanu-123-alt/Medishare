{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - MediShare</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1193d4",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="flex w-64 flex-col bg-white dark:bg-gray-900 p-4 border-r border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-3 mb-8">
                <div class="bg-primary rounded-full size-10 flex items-center justify-center text-white text-xl font-bold">
                    {% if request.session.doctor_name %}
                        {{ request.session.doctor_name|first }}
                    {% else %}
                        D
                    {% endif %}
                </div>
                <h1 class="text-[#111618] dark:text-white text-xl font-bold leading-normal">MediShare</h1>
            </div>
            
            <div class="flex flex-col gap-4 flex-grow">
                <div class="flex flex-col gap-2">
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 dark:bg-primary/20 text-primary" href="{% url 'doctor_dashboard' %}">
                        <span class="material-symbols-outlined">dashboard</span>
                        <p class="text-sm font-medium leading-normal">Dashboard</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" href="{% url 'doctor_patient_records' %}">
                        <span class="material-symbols-outlined">groups</span>
                        <p class="text-sm font-medium leading-normal text-gray-600 dark:text-gray-300">Patients</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" href="{% url 'doctor_booked_appointments' %}">
                        <span class="material-symbols-outlined">calendar_month</span>
                        <p class="text-sm font-medium leading-normal text-gray-600 dark:text-gray-300">Appointments</p>
                    </a>
                    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" href="{% url 'update_doctor_profile' %}">
                        <span class="material-symbols-outlined">bar_chart</span>
                        <p class="text-sm font-medium leading-normal text-gray-600 dark:text-gray-300">Update Profile</p>
                    </a>
                </div>
            </div>
            
            <div class="flex flex-col gap-4">
                <a href="{% url 'appointment_create' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 transition-colors">
                    <span class="truncate">New Appointment Slot</span>
                </a>
                
                <div class="flex items-center gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                    {% if request.session.doctor_image %}
                    <img src="{{ request.session.doctor_image }}" alt="Dr. {{ request.session.doctor_name }}" class="rounded-full size-10 object-cover">
                    {% else %}
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 bg-gray-300 flex items-center justify-center">
                        <span class="material-symbols-outlined text-gray-600">person</span>
                    </div>
                    {% endif %}
                    <div class="flex flex-col">
                        <h1 class="text-[#111618] dark:text-white text-base font-medium leading-normal">Dr. {{ request.session.doctor_name|default:'Doctor' }}</h1>
                        <p class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal">{{ doctor.specialization|default:'General Practitioner' }}</p>
                    </div>
                    <a href="{% url 'doctor_logout' %}" class="ml-auto text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white">
                        <span class="material-symbols-outlined">logout</span>
                    </a>
                </div>
            </div>
        </aside>
{% block content %}
        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <div class="p-8">
                <!-- Header -->
                <header class="flex items-center justify-between mb-8">
                    <div class="flex-1">
                        <div class="max-w-xl">
                            <label class="flex flex-col min-w-40 h-12 w-full">
                                <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
                                    <div class="text-gray-500 dark:text-gray-400 flex border-none bg-white dark:bg-gray-900 items-center justify-center pl-4 rounded-l-lg border-r-0">
                                        <span class="material-symbols-outlined">search</span>
                                    </div>
                                    <input class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111618] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border-none bg-white dark:bg-gray-900 focus:border-none h-full placeholder:text-gray-500 dark:placeholder:text-gray-400 px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" placeholder="Search for patients, appointments, etc." value=""/>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button class="text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white relative">
                            <span class="material-symbols-outlined">notifications</span>
                            {% if upcoming_appointments %}
                            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-orange-500 ring-2 ring-background-light dark:ring-background-dark"></span>
                            {% endif %}
                        </button>
                        <a href="{% url 'doctor_port' %}" class="flex items-center gap-2 text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white">
                            <span class="material-symbols-outlined">settings</span>
                        </a>
                    </div>
                </header>

                <!-- Page Heading -->
                <div class="flex flex-wrap justify-between gap-3 mb-8">
                    <div class="flex min-w-72 flex-col gap-3">
                        <p class="text-[#111618] dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">
                            Good {% if current_hour < 12 %}morning{% elif current_hour < 18 %}afternoon{% else %}evening{% endif %}, Dr. {{ request.session.doctor_name|default:'Doctor' }}
                        </p>
                        <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">
                            Here's a summary of your day. You have {{ booked_slots }} appointments and {{ available_slots }} available slots.
                        </p>
                    </div>
                    <a href="{% url 'doctor_appointment' %}" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-gray-200/50 dark:bg-gray-800/50 text-[#111618] dark:text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                        <span class="truncate">View Full Calendar</span>
                    </a>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
                    <div class="flex flex-1 flex-col gap-2 rounded-xl border border-gray-200 dark:border-gray-700 p-6 bg-white dark:bg-gray-900">
                        <p class="text-[#111618] dark:text-white text-base font-medium leading-normal">Total Slots</p>
                        <p class="text-[#111618] dark:text-white tracking-light text-[32px] font-bold leading-tight truncate">{{ total_slots }}</p>
                        <div class="flex gap-1">
                            <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">This Month</p>
                        </div>
                    </div>
                    <div class="flex flex-1 flex-col gap-2 rounded-xl border border-gray-200 dark:border-gray-700 p-6 bg-white dark:bg-gray-900">
                        <p class="text-[#111618] dark:text-white text-base font-medium leading-normal">Available Slots</p>
                        <p class="text-[#111618] dark:text-white tracking-light text-[32px] font-bold leading-tight truncate">{{ available_slots }}</p>
                        <div class="flex gap-1">
                            <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">Ready for booking</p>
                        </div>
                    </div>
                    <div class="flex flex-1 flex-col gap-2 rounded-xl border border-gray-200 dark:border-gray-700 p-6 bg-white dark:bg-gray-900">
                        <p class="text-[#111618] dark:text-white text-base font-medium leading-normal">Booked Appointments</p>
                        <p class="text-[#111618] dark:text-white tracking-light text-[32px] font-bold leading-tight truncate">{{ booked_slots }}</p>
                        <div class="flex gap-1">
                            <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">Today</p>
                        </div>
                    </div>
                    <div class="flex flex-1 flex-col gap-2 rounded-xl border border-gray-200 dark:border-gray-700 p-6 bg-white dark:bg-gray-900">
                        <p class="text-[#111618] dark:text-white text-base font-medium leading-normal">Hospital</p>
                        <p class="text-[#111618] dark:text-white tracking-light text-lg font-bold leading-tight truncate">{{ doctor.hospital.name }}</p>
                        <div class="flex gap-1">
                            <p class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal">{{ doctor.hospital.location }}</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <!-- Main content area -->
                    <div class="xl:col-span-2 flex flex-col gap-6">
                        <!-- Upcoming Appointments -->
                        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                            <h2 class="text-lg font-semibold mb-4 text-[#111618] dark:text-white">Today's Appointments</h2>
                            <div class="space-y-4">
                                {% if recent_appointments %}
                                    {% for appointment in recent_appointments %}
                                    <div class="flex items-center p-4 rounded-lg bg-background-light dark:bg-background-dark">
                                        <div class="bg-gray-300 rounded-full size-10 mr-4 flex items-center justify-center">
                                            <span class="material-symbols-outlined text-gray-600">person</span>
                                        </div>
                                        <div class="flex-grow">
                                            <p class="font-semibold text-gray-800 dark:text-gray-200">{{ appointment.user.fullname }}</p>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ appointment.reason|truncatewords:5 }}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-medium text-gray-800 dark:text-gray-200">{{ appointment.time|time:"g:i A" }}</p>
                                            <span class="text-xs px-2 py-1 rounded-full 
                                                {% if appointment.status == 'booked' %}bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300
                                                {% elif appointment.status == 'completed' %}bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300
                                                {% else %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300{% endif %}">
                                                {{ appointment.status|title }}
                                            </span>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="text-center py-8">
                                        <span class="material-symbols-outlined text-gray-400 text-4xl mb-3">calendar_today</span>
                                        <p class="text-gray-500 dark:text-gray-400">No appointments scheduled for today</p>
                                        <a href="{% url 'appointment_create' %}" class="text-primary hover:underline mt-2 inline-block">Create appointment slots</a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                            <h2 class="text-lg font-semibold mb-4 text-[#111618] dark:text-white">Quick Actions</h2>
                            <div class="grid grid-cols-2 gap-4">
                                <a href="{% url 'appointment_create' %}" class="flex items-center gap-3 p-4 rounded-lg bg-primary/10 dark:bg-primary/20 text-primary hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors">
                                    <span class="material-symbols-outlined">add_circle</span>
                                    <span class="font-medium">Create Slot</span>
                                </a>
                                <a href="{% url 'doctor_appointment' %}" class="flex items-center gap-3 p-4 rounded-lg bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/30 transition-colors">
                                    <span class="material-symbols-outlined">list_alt</span>
                                    <span class="font-medium">View Slots</span>
                                </a>
                                <a href="{% url 'doctor_patient_records' %}" class="flex items-center gap-3 p-4 rounded-lg bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/30 transition-colors">
                                    <span class="material-symbols-outlined">groups</span>
                                    <span class="font-medium">Patients</span>
                                </a>
                                <a href="{% url 'doctor_port' %}" class="flex items-center gap-3 p-4 rounded-lg bg-purple-100 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-900/30 transition-colors">
                                    <span class="material-symbols-outlined">person</span>
                                    <span class="font-medium">Profile</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar -->
                    <div class="flex flex-col gap-6">
                        <!-- Calendar -->
                        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700">
                            <div class="flex min-w-72 max-w-[336px] flex-1 flex-col gap-0.5 p-4">
                                <div class="flex items-center p-1 justify-between">
                                    <button>
                                        <div class="text-[#111618] dark:text-white flex size-10 items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full">
                                            <span class="material-symbols-outlined text-lg">chevron_left</span>
                                        </div>
                                    </button>
                                    <p class="text-[#111618] dark:text-white text-base font-bold leading-tight flex-1 text-center" id="current-month">
                                        {% now "F Y" %}
                                    </p>
                                    <button>
                                        <div class="text-[#111618] dark:text-white flex size-10 items-center justify-center hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full">
                                            <span class="material-symbols-outlined text-lg">chevron_right</span>
                                        </div>
                                    </button>
                                </div>
                                <div class="grid grid-cols-7">
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">S</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">M</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">T</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">W</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">T</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">F</p>
                                    <p class="text-gray-500 dark:text-gray-400 text-[13px] font-bold tracking-[0.015em] flex h-10 w-full items-center justify-center pb-0.5">S</p>
                                    
                                    <!-- Calendar dates will be populated by JavaScript -->
                                    <div id="calendar-dates" class="col-span-7 grid grid-cols-7">
                                        <!-- Dates will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Tasks -->
                        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                            <h2 class="text-lg font-semibold mb-4 text-[#111618] dark:text-white">Today's Tasks</h2>
                            <div class="space-y-3">
                                {% if recent_appointments %}
                                    {% for appointment in recent_appointments|slice:":3" %}
                                    <label class="flex items-center gap-3">
                                        <input class="form-checkbox h-5 w-5 rounded text-primary focus:ring-primary/50 border-gray-300 dark:border-gray-600 dark:bg-gray-800" type="checkbox"/>
                                        <span class="text-gray-800 dark:text-gray-200">Appointment with {{ appointment.user.fullname }}</span>
                                    </label>
                                    {% endfor %}
                                {% else %}
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">No tasks scheduled for today</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Hospital Info -->
                        <div class="bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
                            <h2 class="text-lg font-semibold mb-4 text-[#111618] dark:text-white">Hospital Information</h2>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-primary">location_on</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-300">{{ doctor.hospital.location }}</span>
                                </div>
                                {% if doctor.hospital.phone %}
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-primary">call</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-300">{{ doctor.hospital.phone }}</span>
                                </div>
                                {% endif %}
                                <div class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-primary">badge</span>
                                    <span class="text-sm text-gray-600 dark:text-gray-300">{{ doctor.specialization }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
{% endblock %}
    <script>
        // Calendar functionality
        function generateCalendar() {
            const now = new Date();
            const month = now.getMonth();
            const year = now.getFullYear();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startingDay = firstDay.getDay();
            const monthLength = lastDay.getDate();
            
            const calendarDates = document.getElementById('calendar-dates');
            calendarDates.innerHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'h-10 w-full';
                calendarDates.appendChild(emptyCell);
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= monthLength; day++) {
                const dateCell = document.createElement('button');
                dateCell.className = `h-10 w-full text-[#111618] dark:text-white text-sm font-medium leading-normal ${
                    day === now.getDate() ? 'bg-primary text-white rounded-full' : ''
                }`;
                dateCell.innerHTML = `<div class="flex size-full items-center justify-center rounded-full ${
                    day !== now.getDate() ? 'hover:bg-gray-100 dark:hover:bg-gray-800' : ''
                }">${day}</div>`;
                calendarDates.appendChild(dateCell);
            }
        }
        
        // Initialize calendar
        generateCalendar();
        
        // Set current hour for greeting
        const currentHour = new Date().getHours();
    </script>
</body>
</html>